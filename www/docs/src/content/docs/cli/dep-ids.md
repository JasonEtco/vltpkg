# Dependency Identifiers (DepIds)

Dependency Identifiers (DepIds) are a special string format used
throughout the VLT package manager to uniquely identify dependencies.
They are used as keys in the lockfile and other internal data
structures.

## Format Overview

DepIds use a special delimiter character (`·`, Unicode MIDDLE DOT) to
separate different parts of the identifier. This character was chosen
because:

- It's visually distinct
- It's unlikely to appear in package names or versions
- It's easy to distinguish in diffs and logs
- It's a single Unicode character, making it efficient to process

## DepId Types

### 1. Registry Dependencies

Registry dependencies are packages installed from a package registry
(like npm).

#### Default Registry

```json
"··name@version"
```

Example: `"··express@5.1.0"`

#### Named Registry

```json
"·registry-name·name@version"
```

Example: `"·npm·lodash@4.17.21"`

#### Custom Registry URL

```json
"·http%3A%2F%2Fvlt.sh%2F·x@1.2.3"
```

### 2. Git Dependencies

Git dependencies are packages installed directly from a Git
repository.

```json
"git·remote·selector"
```

Example: `"git·github:user/project·branchname"`

The `selector` can be:

- Branch name: `main`, `develop`
- Tag: `v1.0.0`
- Commit hash: `a1b2c3d`
- Semver range: `^1.0.0`

### 3. Workspace Dependencies

Workspace dependencies are packages within the same monorepo.

```json
"workspace·path"
```

Example: `"workspace·src/mything"`

### 4. File Dependencies

File dependencies are packages installed from a local file or
directory.

```json
"file·path"
```

Example: `"file·./local-package"`

### 5. Remote Dependencies

Remote dependencies are packages installed from a URL.

```json
"remote·url"
```

Example: `"remote·https%3A%2F%2Fexample.com"`

## Special Cases and Encoding

### Path Encoding

- Forward slashes (`/`) are encoded as `§` (both `%2f` and `%2F`
  cases) - preventing ambiguity in path resolution
- Backslashes (`\`) are not specially encoded and are handled by the
  standard URI encoding

### URL Encoding

- URLs are URI-encoded to ensure safe handling
- Special characters are properly escaped
- Example: `https://example.com` becomes `https%3A%2F%2Fexample.com`
- The `@` symbol is preserved in URLs

### Extra Data

Additional information can be appended to a DepId using another
delimiter:

```json
"··name@version·extra-data"
```

Example: `"··react@18.2.0·peer"`

## Usage in Lockfile

DepIds are used extensively in the lockfile:

### Nodes Section

```json
"nodes": {
  "··express@5.1.0": [0, "express", "sha512-..."]
}
```

### Edges Section

```json
"edges": {
  "file·. express": "prod latest ··express@5.1.0"
}
```

## Benefits

1. **Uniqueness**: Each DepId uniquely identifies a specific
   dependency
2. **Efficiency**: The format is optimized for parsing and comparison
3. **Readability**: The structure is human-readable and easy to
   understand
4. **Extensibility**: The format can be extended with new types and
   data
5. **Tooling Support**: Easy to parse and manipulate in various tools

## Best Practices

1. **Don't Modify Manually**: While DepIds are human-readable, they
   should be generated by the package manager
2. **Use Consistent Encoding**: Always use the proper encoding for
   paths and URLs
3. **Handle Special Cases**: Be aware of special cases like empty
   registry and extra data
4. **Validate Format**: When working with DepIds programmatically,
   validate the format
5. **Consider Performance**: The format is designed for performance,
   so avoid unnecessary string operations

## Examples

### Simple Project

```json
{
  "nodes": {
    "··express@5.1.0": [0, "express", "sha512-..."],
    "··accepts@2.0.0": [0, "accepts", "sha512-..."]
  },
  "edges": {
    "file·. express": "prod latest ··express@5.1.0",
    "··express@5.1.0 accepts": "prod ^2.0.0 ··accepts@2.0.0"
  }
}
```

### Complex Project

```json
{
  "nodes": {
    "··react@18.2.0": [0, "react", "sha512-..."],
    "git·github:types/react·main": [0, "@types/react", "sha512-..."],
    "workspace·packages/core": [0, "@myorg/core", "sha512-..."]
  },
  "edges": {
    "file·. react": "prod ^18.2.0 ··react@18.2.0",
    "file·. @types/react": "dev latest git·github:types/react·main",
    "file·. @myorg/core": "prod latest workspace·packages/core"
  }
}
```
